CONFIGURACION DE SEGURIDAD DEL PERFIL DE MALWARE
	los perfiles de malware contienen la configuracion de seguridad de los modulos de proteccion contra malware MPM (Malware protection module) para evitar malware conocido y desconocido incluidos troyanos, virus y gusanos. Host Insights solo esta disponible en Cortex XDR Pro
	Perfiles de malware tienen las siguientes secciones habilitadas
	![[Pasted image 20241203123422.png]]

1. Flujo contra el malware previo y posterior a la ejecucion: Todos los MPM se configuran en perfiles de malware excepto las restricciones ![[Pasted image 20241203124139.png]]
	1. Previo:
		1. MCP: Grupo de modulos diseñados para un tipo particular de ataque, como la proteccion de procesos secundarios
		2. AR: Listas simples de unidades y rutas desde las que los usuarios finales pueden ejecutar archivos.
		3. Examinacion de ejecutables portables y DLL: Contiene modulos de proteccion basados en veredictos hash, como wildfire y local analysis.
	2. Posterior: Una vez pasado dichos filtros se ejecuta el proceso o archivo, y se analiza continuamente para detectar anomalias que se describen en el diagrama.
2. Actualizaciones en las capacidades de control
	1. Lista completa de permitidos: Seleccionar eprfil de malware / Examen de archivo ejecutable portatil y dll
	2. Lista de permitidos: Centro de actividades / lista de bloqueados o lista de permitidos
	3. Agregar una ruta de archivo a los permitidos: Aerta / Agregar iniciador SHA256


EXAMEN O EXAMINACION DE EJECUTABLES PORTABLES Y DLL

1. Flujo de la examinacion
	1. Un archivo que intenta ejecutarse pasa por el flujo, se llaman a varios responsables de la toma de decisiones, como origenes veredictos, listas de permitidos y listas de bloqueo:
El agente de Cortex XDR aprovecha tres fuentes de veredicto en este precedente:
- Veredictos del administrador
- Veredictos oficiales de WildFire
- Análisis Local: veredictos temporales
	![[Pasted image 20241203125158.png]]
	

  
2. Inteligencia de amenazas wildfire: Wildfire proporciona dos servicios a cortex XDR: 
		1. un servicio de analisis de archivos para crear veredictos de archivos 
		2. un servicio en la nube para proporcionar veredictos.
		 ![[Pasted image 20241203125450.png]]
		 *Static analysis*: Examina archivos sin ejecutarlos
		 *Dynamic analysis*: Ejecuta el archivo en una sandbox para observar su comportamient en tiempo real
		 *Heuristic engine*: Uso de reglas y algoritmos avanzados para identiicar patrones de comportamiento sospechoso
		 *Bare Metal analysis*: Ejecucion en HW fisico real en lugar de entornos virtuales, pues hay malware diseñado para eludir los VM.
		 Diferentes veredictos: 1. MALWARE (Archivo o url maliciosa)     2. BENIGNO (Seguro y sin amenaza)   3. GRAYWARE (Comportamiento de malware pero no malicioso)
		 
		 Hay diferencias entre BTP y Heuristic engine, BTP es en ejecucion real en el endpoint y heuristic es en un sandbox.
		 
3. Análisis local: Si el hash de un archivo ejecutable portatil o una macro no se encuentra en la cache del punto de conexion, XDR consulta el hash en wildfire. El analisis local usa un archivo modelo diferente para cada uno de los tipos de archivos: exe, dll y macro.![[Pasted image 20241203144311.png]]
4. Almacenamiento en cache de veredictos de archivos localmente: Cada agente de cortex mantiene localmente una atbla de busqueda para lmacenar los registros de examen, cadad uno de los cuales consta principalmente del hash y el veredicto de un archivo examinado y el nombre de la fuente del veredicto.

5. Poner en cuarentena automaticamente archivos maliciosos: Los archivos maliciosos cambian de formato y se envian a una ubicacion distinta. A tomar en cuenta:
	1. Restauracion manual: Se puede restaurar un archivo en cuarentena
	2. Configuracion predeterminada: La cuarentena automatica de malware esta deshabilitada por predeterminado.
	3. Limitaciones de la cuarentena: Cuarentena no aplicable a carpetas de red, volumenes de solo lectura o archivos de cifrado con EFS.
	4. Ubicaciones de archivos en cuarentena: %PROGRAMDATA%\Cyvera\QuarantineV2.

6. Como confiar en apicaciones que se publican en internet: A traves de firmas de codigo digital basado en certificados digitales.

7. Configuracion de MPM: La sección Examen de archivos DLL y ejecutables portátiles contiene varias configuraciones de MPM para el flujo de examen de archivos previo a la ejecución para decidir si se debe bloquear un archivo o permitir que se ejecute. También contiene la configuración de la ruta y la lista de permisos del firmante para eximir a un archivo del examen y, por lo tanto, permitir que se ejecute. Esta sección está disponible para que todas las plataformas compatibles examinen archivos ELF, Mach-O y APK.
   
	1. Modo de accion: deshabilitado (Detiene el flujo de examen de archivos)
	2. Poner en cuarentena ejecutables malintencionados
	3. Accion cuando el archivo es desconocido para wildfire: permite al agente XDR utilizar su motor de analisis estatico local, local analysis para determinar la probabilidad de que un archivo desconocido sea malware.
![[Pasted image 20250110160521.png]]


PROTECCION CONTRA AMENAZAS CONDUCTUALES
1. Descripcion general de BTP: BTP es un modulo de proteccion posterior a la ejecucion para detectar de forma inteligente ataques sofisticados mediante la supervision continua de la acvividad de endpoints. y actividad con una lista de reglas predefinidas conocidas como reglas BTP. ![[Pasted image 20241204093719.png]]
2. Tipos de ataque detectados por BTP: BTP esta diseñado para detectar y prevenir ataues basados en scripts.
	1. Deteccion: Detecta patrones de ataques en scripts
	2. Analisis continuo: Analisa continuamente los flujos de actividades en curso para detectar ataques.
3. Reglas BTP: una regla BTP es un conjunto de operaciones predefinidas y agrupadas lógicamente en los recursos que los atacantes aprovechan con frecuencia. Por ejemplo una regla puede constar de operaciones como deshabilitar la seguridad UAC de windows, crear archivos ocultos en system32 y crear un proceso secundario.
	1. Operaciones maliciosas: 
	   ![[Pasted image 20241204094404.png|400]]
4. Configuracion BTP: Posible habilitar la cuarentena de archivos malintencionados para poner en cuarentena el malware detectado por BTP.
	1. BTP puede detectar intentos de cargar controladores vulnerables en puntos finales de windows.
	2. Puede usar archivos/carpetas en la lista de permitidos para especificar procesos que BTP nunca termina, independientemente de las reglas 


MONITOR DE INPSECCION DE PAQUETES DE RED
1. Características del motor de inspección de paquetes de red: Analiza el trafico de red en la capa de protocolo a medida que fluyen a las pilas de red. TCP y UDP, HTTP y DNS.
   Capacidades:
	1. Bloquear paquetes de red maliciosos
	2. Aprovecha las firmas de amenazas NGFW (Firewall de nueva generacion) de PAN
	3. Recibe actualizaciones de contenido

2. Configuracion del motor de inspeccion de paquetes de red: Tiene una unica configuracion de modo de accion. Disponible bajo la licencia de cortex XDR prevent
   - El motor de inspeccion de paquetes de red esta habilitado de forma predeterminada

3. Ventana del motor de inspeccion de paquetes de red: Al hdetectar un ataque se muestra la ventana de alerta de prevencion XDR
   ![[Pasted image 20250110160908.png]]

OTROS MODULOS DE PROTECCION CONTRA EL MALWARE
1. Examen de archivos de oficina con macros: XDR puede evitar que las macros maliciosas en archivos de office pongan en peligro el endpoint:
   Flujo de examen de macros
   - Cuando el usuario abre el archivo XDR inicia un flujo de examen de macros, calcula el hash del macro en el archivo y comprueba la memoria cache local para obtener un veredicto
   - Si no hay veredicto se consulta a wildfire con el hash de macro
   - Si el veredicto de wildfire es malware, el agente bloquea la apertura del archivo
   - Si el veredicto de wildfire es desconocido, se llama al analisis local para obtener una decision inmediata sobre si permitir que se abra el archivo
   - XDR puede enviar el archivo a wildfire para un analisis completo.

2. Proteccion de procesos secundarios malintencionados: Bloquea los procesos dirigidos conocidos para que no inicien procesos secundarios legitimos usados para fines malintencionados.
   La tecnica de ataque de proceso secundario malicioso suele ser utilizada por ransomware u otro malware para eludir medidas de seguridad tradicionales, como archivos word con macros y que ejecute motores de scripts del sistema operativo como powershell para ejecutar scripts malintencionados. Ademas de descargar zip extraerlos e instalarlos y copiarlos lateralmente en los demas puntos de conexion
   ![[Pasted image 20241204113534.png]]

3. Proteccion contra ransomware: En un ataque ransomware tipico el atacante utiliza dll, macros, scripts de shell y ortos metodos para cifrar datos importantes hasta dar un pago.
   Capacidades de proteccion contra ransomware:
   - Genera un evento de seguridad: El agente XDR genera un evento para cada proceso de ataque una vez por minuto para evitar un registro excesivo.
   - Detecta y bloquea el proceso: XDR detecta y blouea el proceso de un ransomware en funcion de su comportamiento frente a a lgunos archivos señuelo.
   - Estimula los archivos señuelo: Los archivos señuelo son archivos ocultos y protegidos que el agente Cortex XDR dispersa por el sistema de archivos. Los nombres de los archivos y las ubicaciones de los señuelos se basan en el análisis realizado por el equipo de investigación de la Unidad 42 de Palo Alto Networks.

4. Proteccion contra robo de contraseñas: Mimikatz es un xploit en windows que extrae contraseñas almacenadas en la memoria y un software que realiza ese exploit. XDR peude bloquearlo.
5. Responder a las cadenas de causalidad maliciosas: Cuando el agente Cortex XDR detecta una actividad maliciosa, el módulo Responder a cadenas de causalidad maliciosas inspecciona las conexiones de red abiertas por los procesos implicados en el ataque para identificar las direcciones IP maliciosas.
   Si se encuentran dichas conexiones de red, este módulo de protección puede cerrar automáticamente todas las conexiones de red y bloquear nuevas solicitudes de conexión de estas direcciones IP.

6. Modulo de proteccion anti webshell: Cuando XDR detecta actividad de webshell puede bloquearla o informar sobre la actividad. ademas de poner los archivos en cuarentena. **Endpoints > Policy Management > Prevention > Profiles > Malware > Edit Profile > Anti Webshell Protection**
  ![[Pasted image 20250110163301.png]]
  
7. Modulo de proteccion de recopilacion de credenciales: XDR puede detectar actividad diseñada para recopilar contraseñas, las bloquea o informa, ademas los archivos pueden ir a cuarentena. **Endpoints > Gestión de políticas > prevención > perfiles > malware > Editar perfil > Módulo de protección de recopilación de credenciales**
   ![[Pasted image 20250110163244.png]]
   
8. Proteccion contra amenazas de malware financiero: XDR detecta actividad financiera y bancaria maliciosa, puede bloquear la actividad o informar sobre la actividad.  **Endpoints > Policy Management > Prevention > Profiles > Malware > Edit Profile Protección > contra amenazas de malware financiero**
   ![[Pasted image 20250110163328.png]]
   
9. Proteccion de criptomineros: XDR detecta actividad de criptomineria, bloquea la actividad o informa sobre la misma. **Endpoints > Gestión de políticas > prevención > perfiles > Malware > Editar perfil > Protección de criptomineros**

10. Proteccion de shellcode en proceso: XDR detecta actividad de shellcode en proceso, la bloquea o informa. **Endpoints > Policy Management > Prevention > Profiles > Malware > Edit Profile > protección de shellcode en proceso**


ESCANEO DE ENDPOINTS
1. Escaneo de archivos locales: Examina los sistemas de archivos locales de los puntos de conexion en busca de archivos PE y archivos de office que contengan macros
	1. Escaneo periodico: Tiempo programado
	2. Escaneo bajo demanda: Inicia un analisis de peticion en uno o varios puntos de conexion, puede iniciar desde la consola o desde el endpoint con cytool
	![[Pasted image 20241204120454.png]]
2. Configuracion de analisis de puntos de conexion: Al realizar el analisis de puntos de conexion, puede especificar sus selecciones
	1. Deshabilitar el analisis local iniciado por el usuario final
	2. Establecer dia y hora
	3. Elegir frecuencia de escaneo de unidades de medios extraibles
	4. Elegir archivos para examinar


